<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>MediStore - Delete Product</title>
</head>
<body>
  <script>
    function qs(name, def = null) {
      const params = new URLSearchParams(location.search);
      return params.get(name) ?? def;
    }

    async function deleteProduct(id) {
      if (!id) {
        alert('Invalid product ID.');
        return;
      }
      if (!confirm('Are you sure you want to delete this product?')) {
        window.location.href = './view_product.html';
        return;
      }
      try {
        const formData = new FormData();
        formData.append('id', id);

        // ✅ Correct backend path
        const res = await fetch('../../Backend/admin/delete_product.php', { 
          method: 'POST', 
          body: formData 
        });

        // ✅ Parse JSON response
        const data = await res.json();
        alert(data.msg || 'Delete request completed.');

        // ✅ Redirect back to product list
        window.location.href = './view_product.html';
      } catch (e) {
        console.error(e);
        alert('❌ Network error');
      }
    }

    async function mountMasterAndContent() {
      // Load master template
      const res = await fetch('./master_template.html');
      const html = await res.text();
      const doc = new DOMParser().parseFromString(html, 'text/html');
      document.documentElement.innerHTML = doc.documentElement.innerHTML;

      document.getElementById('sectionTitle').innerText = 'Delete Product';

      const id = qs('id', '');
      const content = `
        <div id="deleteProductSection">
          <div class="custom-card p-4">
            <p class="mb-3">Product ID: <strong>${id || 'N/A'}</strong></p>
            <div class="d-flex gap-2">
              <a href="./view_product.html" class="btn btn-secondary">Cancel</a>
              <button class="btn btn-danger" id="deleteBtn">Delete Product</button>
            </div>
          </div>
        </div>
      `;
      document.getElementById('pageContent').innerHTML = content;

      document.getElementById('deleteBtn').addEventListener('click', () => deleteProduct(id));
    }

    mountMasterAndContent();
  </script>
</body>
</html>
