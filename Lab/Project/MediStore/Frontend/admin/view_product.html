<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>MediStore - View Products</title>
</head>

<body>
  <script>
    async function loadProducts() {
      const table = document.getElementById('productTable');
      table.innerHTML = '';
      try {
        const res = await fetch('../../Backend/admin/list_products.php');
        const data = await res.json();
        if (data.success) {
          data.data.forEach((p, index) => {
            const imgCell = p.image
              ? `<img src="../../Backend/admin/uploads/${p.image}" width="50" alt="Product">`
              : 'No Image';
            table.innerHTML += `
              <tr>
                <td>${p.name}</td>
                <td>$${p.price}</td>
                <td>${p.qty}</td>
                <td>${p.category || '-'}</td>
                <td>${p.description || '-'}</td>
                <td>${imgCell}</td>
                <td>
                  <a class="btn btn-main btn-sm me-2" href="./update_product.html?id=${p.id}">Edit</a>
                  <a class="btn btn-danger btn-sm" href="./delete_product.html?id=${encodeURIComponent(p.id)}">Delete</a>
                </td>
              </tr>
            `;
          });
        } else {
          table.innerHTML = `<tr><td colspan="7" class="text-center text-muted">No products found.</td></tr>`;
        }
      } catch (e) {
        console.error(e);
        alert('‚ùå Network error');
      }
    }

    async function mountMasterAndContent() {
      const res = await fetch('./master_template.html');
      const html = await res.text();
      const doc = new DOMParser().parseFromString(html, 'text/html');
      document.documentElement.innerHTML = doc.documentElement.innerHTML;

      document.getElementById('sectionTitle').innerText = 'View Products';

      const content = `
        <div id="viewProductSection">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h4>All Products</h4>
            <a class="btn btn-success add-product-btn" href="./add_product.html">
              <i class="fas fa-plus me-1"></i> Add New Product
            </a>
          </div>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Product Name</th>
                <th>Price</th>
                <th>Qty</th>
                <th>Category</th>
                <th>Description</th>
                <th>Image</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="productTable"></tbody>
          </table>
        </div>
      `;
      document.getElementById('pageContent').innerHTML = content;

      await loadProducts();
    }

    mountMasterAndContent();
  </script>
</body>

</html>